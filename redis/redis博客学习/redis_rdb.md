## Redis RDB持久化

RDB，就是将当前内存中的数据集快照写入磁盘中，恢复时将快照文件直接读到内存中。

默认快照文件名称：dump.rdb

### 触发方式

#### 自动触发

**①、save** 配置

```
save 900 1：表示900 秒内如果至少有 1 个 key 的值变化，则保存
save 300 10：表示300 秒内如果至少有 10 个 key 的值变化，则保存
save 60 10000：表示60 秒内如果至少有 10000 个 key 的值变化，则保存
```

可以使用`save ""` 来停用Redis的持久化功能

#### 手动触发

1、save

该命令会阻塞当前Redis服务器，执行save命令期间，Redis不能处理其他命令，知道RDB过程完成

2、bgsave

执行该命令，Redis会在后台异步执行快照操作，快照同时还可以响应客户端请求，具体操作是Redis进程执行**fork操作创建子进程**，**RDB持久化**过程由子进程负责，完成后自动结束。阻塞只发生在fork阶段，一般时间很短。

### 恢复数据

将备份文件 (dump.rdb) 移动到 **redis 安装目录**并启动服务即可，redis就会自动加载文件数据至内存了。Redis 服务器在载入 RDB 文件期间，会一直处于阻塞状态，直到载入工作完成为止。

获取 redis 的安装目录可以使用 config get dir 命令

### RDB的优势和劣势

#### 优势

- RDB是一个紧凑的文件，它保存了Redis在某个时间点上的数据集。这种文件非常适合用于进行备份和灾难恢复。
- 生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。

#### 劣势

- RDB方式数据没办法做到实时持久化/秒级持久化
- 在一定间隔时间做一次备份，所以如果redis意外down掉的话，就会丢失最后一次快照后的所有修改(数据有丢失)

### Redis自动保存原理

