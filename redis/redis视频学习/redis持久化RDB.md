## Redis持久化 RDB

### RDB (Reduis DataBase)

> 指定时间间隔将内存中的数据集快照写入磁盘

存储过程：开启子进程新开一个空间来存储redis中的数据，同步完成之后，再用临时文件替换上次持久化的文件dump.rdb。（写时复制技术）

整个过程，主进程不进行任何io操作，高效。

RDB的缺点是 数据可能会丢失，不是每一刻持久化都是最新的，毕竟有间隔和版本的定义。



`save ` ：只管保存，其他不管，全部阻塞

`bgsave`：Redis会在后台异步执行快照操作，根据不同规则来区分不同的版本，同时还可以响应客户端请求，此时的客户端操作是新的版本



#### 具体实现

C语言Fork，复制一个与当前进程一样的进程。（变量、环境变量、程序计数器）数值和原进程都一样，将该进程的数据进行备份。

在执行fork的时候操作系统（类Unix操作系统）会使用**写时复制（copy-on-write）策略**，即fork函数发生的一刻父子进程共享**同一内存数据**，当父进程要更改其中某片数据时（如执行一个写命令 ），操作系统会将该**片数据复制一份以保证子进程的数据**不受影响，所以新的RDB文件存储的是执行fork那一刻的内存数据。
Redis在进行快照的过程中不会修改RDB文件，只有快照结束后才会将旧的文件替换成新的，也就是说**任何时候RDB文件都是完整的**。这使得我们可以通过定时备份RDB文件来实 现Redis数据库备份

#### 优 点

- 定时存储，保证了某个时刻的数据的完整性，
- RDB文件紧凑 节省空间
- 生成RDB文件的时候，redis主进程会fork()一个子进程来处理所有保存工作，主进程不需要进行任何磁盘IO操作。读写操作

#### 缺 点

发生故障停机， 你就可能会丢失好几分钟的数据。