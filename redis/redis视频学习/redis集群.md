## redis 集群 cluster‘

Redis集群实现了对于Redis的水平扩容，即启动N个Redis节点，将整个数据库分布存储在这N个节点中，每个节点存储总数据的1/N





集群的实现主要有两种方式

- 代理集群：增加中间代理，将操作分配到合适的Redis实例
- 客户端分片：根据不同的服务，分到不同的Redis实例
- 去中心化集群：使用Redis cluster，根据插槽来决定操作是在哪个Redis实例中执行

分配



### Redis slots

生成集群后的会显示有多少个插槽准备完毕

假如是16384则代表

一个Redis集群包含16384个插槽(hashslot)，数据库众的每个键都属于这16384个插槽中的其中一个



集群使用公式`CRC16(key)%`16384来计算键key属于哪个槽位，继而分配到不同的Redis节点。

每个Redis节点负责的一部分的插槽



#### 故障恢复

主机故障，则从机自动成为主机，前主机再连接回来还是从机（哨兵模式）

某个段的主从都挂了，那么代表某一部分槽位无法使用，根据配置来决定是否挂了整个集群



